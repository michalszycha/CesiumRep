<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Use correct character set. -->
  <meta charset="utf-8">
  <!-- Tell IE to use the latest, best version. -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <title>Samoloty</title>
  <script src="../Build/Cesium/Cesium.js"></script>
  <style>
      @import url(../Build/Cesium/Widgets/widgets.css);
      html, body, #cesiumContainer {
          width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
      }
	  .toolbar1 {
            display: block;
            position: absolute;
            top: 350px;
            left: 1000px;

		}
		.toolbar2 {
            display: block;
            position: absolute;
            top: 500px;
            left: 1000px;

		}
		#lista_lotow, td{
			border: 1px solid black;
		}


  </style>
</head>
<body>
	<div id="cesiumContainer">



		<div id="buttonContainer1" style="position:absolute; left:2px; top:25px;
		z-index:1;">
		<button onclick="patrz_z_gory()" class="cesiumbutton">
		Patrz z góry</button>
		</div>

		<div id="buttonContainer" style="position:absolute; left:2px; top:48px;
		z-index:1;">
		<button onclick="zmien_czas(2019,5,5,1+1)" class="cesiumbutton">
		5. czerwiec 2019</button>
		</div>

		<div id="buttonContainer" style="position:absolute; left:2px; top:71px;
		z-index:1;">
		<button onclick="zmien_czas(2018,8,29,1+1)" class="cesiumbutton">
		29. wrzesień 2018</button>
		</div>

		<div id="buttonContainer" style="position:absolute; left:2px; top:94px;
		z-index:1;">
		<button onclick="zmien_czas(2017,1,18,1)" class="cesiumbutton">
		18. luty 2017</button>
		</div>

    <div id="buttonContainer" style="position:absolute; left:140px; top:71px;
		z-index:1;">
		<button onclick="pas1()" class="cesiumbutton">
		Pas 1</button>
		</div>

    <div id="buttonContainer" style="position:absolute; left:140px; top:94px;
		z-index:1;">
		<button onclick="pas2()" class="cesiumbutton">
		Pas 2</button>
		</div>

		<div id="buttonContainer" style="position:absolute; left:2px; top:150px;
		z-index:1;">
		<button id="button_ukryj_GDN_WAW0" onclick="ukryj_lot(0, 1)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute; left:2px; top:173px;
		z-index:1;">
		<button id="button_ukryj_GDN_WAW1" onclick="ukryj_lot(1, 1)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute; left:2px; top:196px;
		z-index:1;">
		<button id="button_ukryj_GDN_WAW2" onclick="ukryj_lot(2, 1)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute; left:2px; top:219px;
		z-index:1;">
		<button id="button_ukryj_GDN_WAW3" onclick="ukryj_lot(3, 1)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute; left:2px; top:242px;
		z-index:1;">
		<button id="button_ukryj_GDN_WAW4" onclick="ukryj_lot(4, 1)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute; left:2px; top:265px;
		z-index:1;">
		<button id="button_ukryj_GDN_WAW5" onclick="ukryj_lot(5, 1)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute; left:125px; top:150px;
		z-index:1;">
		<button id="button_ukryj_WAW_GDN0" onclick="ukryj_lot(0, 0)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute; left:125px; top:173px;
		z-index:1;">
		<button id="button_ukryj_WAW_GDN1" onclick="ukryj_lot(1, 0)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute; left:125px; top:196px;
		z-index:1;">
		<button id="button_ukryj_WAW_GDN2" onclick="ukryj_lot(2, 0)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute; left:125px; top:219px;
		z-index:1;">
		<button id="button_ukryj_WAW_GDN3" onclick="ukryj_lot(3, 0)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute; left:125px; top:242px;
		z-index:1;">
		<button id="button_ukryj_WAW_GDN4" onclick="ukryj_lot(4, 0)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute; left:125px; top:265px;
		z-index:1;">
		<button id="button_ukryj_WAW_GDN5" onclick="ukryj_lot(5, 0)" class="cesiumbutton"></button>
		</div>

		<div id="buttonContainer" style="position:absolute;left:2px;top:300px;
		z-index:1;">
		<button id="button_obserwuj_GDN_WAW0" onclick="obserwuj_lot(0,1)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute;left:2px;top:323px;
		z-index:1;">
		<button id="button_obserwuj_GDN_WAW1" onclick="obserwuj_lot(1,1)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute;left:2px;top:346px;
		z-index:1;">
		<button id="button_obserwuj_GDN_WAW2" onclick="obserwuj_lot(2,1)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute;left:2px;top:369px;
		z-index:1;">
		<button id="button_obserwuj_GDN_WAW3" onclick="obserwuj_lot(3,1)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute;left:2px;top:392px;
		z-index:1;">
		<button id="button_obserwuj_GDN_WAW4" onclick="obserwuj_lot(4,1)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute;left:2px;top:415px;
		z-index:1;">
		<button id="button_obserwuj_GDN_WAW5" onclick="obserwuj_lot(5,1)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute;left:150px;top:300px;
		z-index:1;">
		<button id="button_obserwuj_WAW_GDN0" onclick="obserwuj_lot(0,0)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute;left:150px;top:323px;
		z-index:1;">
		<button id="button_obserwuj_WAW_GDN1" onclick="obserwuj_lot(1,0)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute;left:150px;top:346px;
		z-index:1;">
		<button id="button_obserwuj_WAW_GDN2" onclick="obserwuj_lot(2,0)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute;left:150px;top:369px;
		z-index:1;">
		<button id="button_obserwuj_WAW_GDN3" onclick="obserwuj_lot(3,0)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute;left:150px;top:392px;
		z-index:1;">
		<button id="button_obserwuj_WAW_GDN4" onclick="obserwuj_lot(4,0)" class="cesiumbutton"></button>
		</div>
		<div id="buttonContainer" style="position:absolute;left:150px;top:415px;
		z-index:1;">
		<button id="button_obserwuj_WAW_GDN5" onclick="obserwuj_lot(5,0)" class="cesiumbutton"></button>
		</div>

	</div>
	<div class="toolbar1">
		<table width = 150 bgcolor= "#fcf81f";><tbody>
			<tr>
				<td>Loty GDN-WAW</td>
			</tr>
		</tbody></table>
		<table id = "lista_lotow_GDN-WAW" bgcolor= "#ffffff"><tbody>
			<tr>
				<td>Wylot</td>
				<td>Przylot</td>
				<td>Nr lotu</td>
			</tr>
		</tbody></table>
	</div>
	<div class="toolbar2">
			<table width = 150 bgcolor= "#fcf81f";><tbody>
				<tr>
					<td>Loty WAW-GDN</td>
				</tr>
			</tbody></table>
			<table id = "lista_lotow_WAW-GDN" bgcolor= "#ffffff"><tbody>
				<tr>
					<td>Wylot</td>
					<td>Przylot</td>
					<td>Nr lotu</td>
				</tr>
			</tbody></table>
		</div>

  <script>





	class Czas {
		constructor(rok,miesiac,dzien,godzina) {
			this.rok = rok;
			this.miesiac = miesiac;
			this.dzien = dzien;
			this.godzina = godzina;
		}

		zwroc_czas() {
			var czas_cesium = Cesium.JulianDate.fromDate(new Date(this.rok, this.miesiac, this.dzien, this.godzina), new Cesium.JulianDate());
			return czas_cesium;
		}
	}

	//Definicja klasy wspolrzednych pasow startowych
	class PasyStartowe {
		constructor(start_lat, start_long, koniec_lat, koniec_long){
		this.start_lat = start_lat;
		this.start_long = start_long;
		this.koniec_lat = koniec_lat;
		this.koniec_long = koniec_long;
		}
	}
	//Stworzenie obiektów konkretnych pasów startowych
	gdansk_pas1 = new PasyStartowe(54.380887, 18.452738, 54.371910, 18.489267);
	warszawa_pas1 = new PasyStartowe(52.155907, 20.975687, 52.177143, 20.957177);
  warszawa_pas2 = new PasyStartowe(52.162706, 20.978023, 52.170552, 20.95004);


	//Definicja klasy lotow z Gdanska do Warszawy
	class GdnToWaw {
		constructor(id, wylot, przylot, numer_lotu, obserwuj,wylot2,przylot2) {
			this.id = id;
			this.wylot = wylot;
			this.przylot = przylot;
			this.numer_lotu = numer_lotu;
			this.obserwuj = obserwuj;
			this.wylot2 = wylot2;
			this.przylot2 = przylot2;
		}

	}

	//Stworzenie obiektow konkretnych lotow klasy Gdansk - Warszawa
	gdnwaw1 = new GdnToWaw(0,19800, 23700, 'LO3828', true,'05:30','06:35'); //05:30 - 06:35
	gdnwaw2 = new GdnToWaw(1,31500, 35100, 'LO3832', true,'08:45','09:45'); //08:45 - 09:45
	gdnwaw3 = new GdnToWaw(2,43500, 47100, 'LO3836', true,'12:05','13:05'); //12:05 - 13:05
	gdnwaw4 = new GdnToWaw(3,53700, 57300, 'LO3838', true,'14:55','15:55'); //14:55 - 15:55
	gdnwaw5 = new GdnToWaw(4,65400, 69300, 'LO3816', true,'18:10','19:15'); //18:10 - 19:15
	gdnwaw6 = new GdnToWaw(5,75900, 79500, 'LO3826', true,'21:05','22:05'); //21:05 - 22:05

	//tabilca z lotami Gdansk - Warszawa
	var gdnwaw = [];
	gdnwaw[0] = gdnwaw1;
	gdnwaw[1] = gdnwaw2;
	gdnwaw[2] = gdnwaw3;
	gdnwaw[3] = gdnwaw4;
	gdnwaw[4] = gdnwaw5;
	gdnwaw[5] = gdnwaw6;


	//Definicja klasy lotow z Warszawy do Gdanska
	class WawToGdn {
		constructor(id,wylot, przylot, numer_lotu, obserwuj,wylot2,przylot2) {
		this.id = id;
		this.wylot = wylot;
		this.przylot = przylot;
		this.numer_lotu = numer_lotu;
		this.obserwuj = obserwuj;
		this.wylot2 = wylot2;
		this.przylot2 = przylot2;
		}
	}

	//Stworzenie obiektow konkretnych lotow klasy Warszawa - Gdansk
	wawgdn1 = new WawToGdn(0,26100, 29700, 'LO3831', true,'07:15','08:15'); //07:15 - 08:15
	wawgdn2 = new WawToGdn(1,38100, 41700, 'LO3835', true,'10:35','11:35'); //10:35 - 11:35
	wawgdn3 = new WawToGdn(2,48000, 51300, 'LO3837', true,'13:20','14:15'); //13:20 - 14:15
	wawgdn4 = new WawToGdn(3,59400, 63000, 'LO3815', true,'16:30','17:30'); //16:30 - 17:30
	wawgdn5 = new WawToGdn(4,70800, 74100, 'LO3825', true,'19:40','20:35'); //19:40 - 20:35
	wawgdn6 = new WawToGdn(5,81300, 84900, 'LO3827', true,'22:35','23:35'); //22:35 - 23:35

	//tabilca z lotami Warszawa - Gdansk
	var wawgdn = [];
	wawgdn[0] = wawgdn1;
	wawgdn[1] = wawgdn2;
	wawgdn[2] = wawgdn3;
	wawgdn[3] = wawgdn4;
	wawgdn[4] = wawgdn5;
	wawgdn[5] = wawgdn6;

	//uzupelnianie podpisow przyciskow
	for (var i=0;i<6;i++) {
		var id_button = "button_ukryj_GDN_WAW"+i;
		var x = document.getElementById(id_button);
		x.textContent = "Ukryj lot " + gdnwaw[i].numer_lotu;
	}
	for (var i=0;i<6;i++) {
		var id_button = "button_ukryj_WAW_GDN"+i;
		var x = document.getElementById(id_button);
		x.textContent = "Ukryj lot " + wawgdn[i].numer_lotu;
	}
	for (var i=0;i<6;i++) {
		var id_button = "button_obserwuj_GDN_WAW"+i;
		var x = document.getElementById(id_button);
		x.textContent = "Obserwuj lot " + gdnwaw[i].numer_lotu;
	}
	for (var i=0;i<6;i++) {
		var id_button = "button_obserwuj_WAW_GDN"+i;
		var x = document.getElementById(id_button);
		x.textContent = "Obserwuj lot " + wawgdn[i].numer_lotu;
	}

	//funkcja do sledzenia lotow
	function obserwuj_lot(i,kierunek) {
		if(kierunek) {
			if(gdnwaw[i].obserwuj) {
			viewer.trackedEntity = viewer.entities.getById(gdnwaw[i].numer_lotu);
			}
			else {
				viewer.trackedEntity = undefined;
			}
			gdnwaw[i].obserwuj = !gdnwaw[i].obserwuj;
		}
		else {
			if(wawgdn[i].obserwuj) {
			viewer.trackedEntity = viewer.entities.getById(wawgdn[i].numer_lotu);
			}
			else {
				viewer.trackedEntity = undefined;
			}
			wawgdn[i].obserwuj = !wawgdn[i].obserwuj;
		}
	}

	function patrz_z_gory() {
		viewer.trackedEntity = undefined;
		viewer.zoomTo(viewer.entities, new Cesium.HeadingPitchRange(0, Cesium.Math.toRadians(-90)));
	}

	//funkcja do ukrywania/pokazywania lotow
	function ukryj_lot(i,kierunek) {
		if(kierunek) {
			var ukryj_tekst = "Ukryj lot "+gdnwaw[i].numer_lotu;
			var pokaz_tekst = "Pokaz lot "+gdnwaw[i].numer_lotu;
			var id_button = "button_ukryj_GDN_WAW"+i;
			var x = document.getElementById(id_button);
			id_tab_GDN_WAW[i].show = !id_tab_GDN_WAW[i].show;
			if(id_tab_GDN_WAW[i].show) {
				x.textContent = ukryj_tekst;
			}
			else {
				x.textContent = pokaz_tekst;
			}
		}
		else {
			var ukryj_tekst = "Ukryj lot "+wawgdn[i].numer_lotu;
			var pokaz_tekst = "Pokaz lot "+wawgdn[i].numer_lotu;
			var id_button = "button_ukryj_WAW_GDN"+i;
			var x = document.getElementById(id_button);
			id_tab_WAW_GDN[i].show = !id_tab_WAW_GDN[i].show;
			if(id_tab_WAW_GDN[i].show) {
				x.textContent = ukryj_tekst;
			}
			else {
				x.textContent = pokaz_tekst;
			}
		}
	}

	function sleep(ms) {
  		return new Promise(resolve => setTimeout(resolve, ms));
	}

	//funkcja zmiany czasy symulacji
	function zmien_czas(rok_start, miesiac_start, dzien_start, godzina_start) {
		rok_symulacji = rok_start;
		miesiac_symulacji = miesiac_start;
		dzien_symulacji = dzien_start;
		czas_start = new Czas(rok_start,miesiac_start,dzien_start,godzina_start)
		start = Cesium.JulianDate.fromDate(new Date(rok_start,miesiac_start,dzien_start,godzina_start));
		//start = czas_start.zwroc_czas();
		stop = Cesium.JulianDate.addSeconds(start, 86400, new Cesium.JulianDate());
		viewer.clock.startTime = start.clone();
		viewer.clock.stopTime = stop.clone();
		viewer.clock.currentTime = start.clone();
		viewer.clock.clockRange = Cesium.ClockRange.LOOP_STOP; //Loop at the end
		viewer.clock.multiplier = 10;
		//usun dotychczasowe entities
		for (var i=0; i<6; i++) {
			viewer.entities.removeById(gdnwaw[i].numer_lotu);
			viewer.entities.removeById(wawgdn[i].numer_lotu);
		}
		pozycje_loty_GDN_WAW = [];
		pozycje_loty_WAW_GDN = [];
		id_tab_GDN_WAW = [];
		id_tab_WAW_GDN = [];
		//inicjalizacja_entity(rok_start,miesiac_start,dzien_start);
	}

	//definicja funkcji zwracającej sciezke lotu samolotu z Gdanska do Warszawy
	//przekazywane parametry to wlasciwosci obiektow klasy GdnToWaw (wylot,przylot)
	function generuj_trase_GDN_WAW(id,czas_start,czas_stop,rok_symulacji,miesiac_symulacji,dzien_symulacji){
		//definicja zmiennej przechowujacej wspolrzedne i czas
		var property = new Cesium.SampledPositionProperty();
		//definicja czasu jako poczatek lotu
		var time = Cesium.JulianDate.fromDate(new Date(rok_symulacji, miesiac_symulacji, dzien_symulacji, 1));

		//dodanie punktu poczatkowego na pasie w Gdansku
		time = Cesium.JulianDate.addSeconds(time, czas_start, new Cesium.JulianDate());
		czasy_GDN_WAW_start[id] = time;
		var position = Cesium.Cartesian3.fromDegrees(gdansk_pas1.start_long, gdansk_pas1.start_lat, 170.0);
		property.addSample(time, position);

		//dodanie punktu na koncu pasa w Gdansku (60s pozniej)
		time = Cesium.JulianDate.addSeconds(time, 60, new Cesium.JulianDate());
		position = Cesium.Cartesian3.fromDegrees(gdansk_pas1.koniec_long, gdansk_pas1.koniec_lat, 180.0);
		property.addSample(time, position);

		//pozostaly czas na animacje lotu minus 2*60s na start i lądowanie minus 10s wyrównanie lądowania
		var reszta_czasu = czas_stop - czas_start - 120 - 360;
		var krok_czasu = reszta_czasu / 4; //4 kroków (punktow)

		//dodanie punktow dla pozostałego czasu pomiedzy startem i lądowaniem
		for (var i = 1; i <= 4; i += 1) {
			time = Cesium.JulianDate.addSeconds(time, krok_czasu, new Cesium.JulianDate());
			position = Cesium.Cartesian3.fromDegrees(gdansk_pas1.koniec_long + (0.49 * i), gdansk_pas1.koniec_lat - (0.44 * i), ((5 % i)+1) * 11000.0);
			property.addSample(time, position);
		}

		//dodanie punktu na końcu pasa w Warszawie (10s pozniej - trafienie w pas)
		time = Cesium.JulianDate.addSeconds(time, 360, new Cesium.JulianDate());
		position = Cesium.Cartesian3.fromDegrees(warszawa_pas1.koniec_long, warszawa_pas1.koniec_lat, 140.0);
		property.addSample(time, position);

		//dodanie punktu na poczatku pasa w Warszawie (60s pozniej)
		time = Cesium.JulianDate.addSeconds(time, 60, new Cesium.JulianDate());
		czasy_GDN_WAW_koniec[id] = time;
		position = Cesium.Cartesian3.fromDegrees(warszawa_pas1.start_long, warszawa_pas1.start_lat, 140.0);
		property.addSample(time, position);
	return property
	}

  //definicja funkcji zwracającej sciezke lotu samolotu z Gdanska do Warszawy2
	//przekazywane parametry to wlasciwosci obiektow klasy GdnToWaw (wylot,przylot)
	function generuj_trase_GDN_WAW2(id,czas_start,czas_stop,rok_symulacji,miesiac_symulacji,dzien_symulacji){
		//definicja zmiennej przechowujacej wspolrzedne i czas
		var property = new Cesium.SampledPositionProperty();
		//definicja czasu jako poczatek lotu
		var time = Cesium.JulianDate.fromDate(new Date(rok_symulacji, miesiac_symulacji, dzien_symulacji, 1));

		//dodanie punktu poczatkowego na pasie w Gdansku
		time = Cesium.JulianDate.addSeconds(time, czas_start, new Cesium.JulianDate());
		czasy_GDN_WAW_start[id] = time;
		var position = Cesium.Cartesian3.fromDegrees(gdansk_pas1.start_long, gdansk_pas1.start_lat, 170.0);
		property.addSample(time, position);
		

		//dodanie punktu na koncu pasa w Gdansku (60s pozniej)
		time = Cesium.JulianDate.addSeconds(time, 60, new Cesium.JulianDate());
		position = Cesium.Cartesian3.fromDegrees(gdansk_pas1.koniec_long, gdansk_pas1.koniec_lat, 180.0);
		property.addSample(time, position);

		//pozostaly czas na animacje lotu minus 2*60s na start i lądowanie minus 10s wyrównanie lądowania
		var reszta_czasu = czas_stop - czas_start - 120 - 360;
		var krok_czasu = reszta_czasu / 4; //4 kroków (punktow)

		//dodanie punktow dla pozostałego czasu pomiedzy startem i lądowaniem
		for (var i = 1; i <= 4; i += 1) {
			time = Cesium.JulianDate.addSeconds(time, krok_czasu, new Cesium.JulianDate());
			position = Cesium.Cartesian3.fromDegrees(gdansk_pas1.koniec_long + (0.49 * i), gdansk_pas1.koniec_lat - (0.44 * i), ((5 % i)+1) * 11000.0);
			property.addSample(time, position);
		}

		//dodanie punktu na końcu pasa w Warszawie (10s pozniej - trafienie w pas)
		time = Cesium.JulianDate.addSeconds(time, 360, new Cesium.JulianDate());
		position = Cesium.Cartesian3.fromDegrees(warszawa_pas2.koniec_long, warszawa_pas2.koniec_lat, 140.0);
		property.addSample(time, position);

		//dodanie punktu na poczatku pasa w Warszawie (60s pozniej)
		time = Cesium.JulianDate.addSeconds(time, 60, new Cesium.JulianDate());
		czasy_GDN_WAW_koniec[id] = time;
		position = Cesium.Cartesian3.fromDegrees(warszawa_pas2.start_long, warszawa_pas2.start_lat, 140.0);
		property.addSample(time, position);
		
	return property
	}


  //definicja funkcji zwracającej sciezke lotu samolotu z Warszawy do Gdanska
  //przekazywane parametry to wlasciwosci obiektow klasy WawToGdn (wylot,przylot)
  function generuj_trase_WAW_GDN(id,czas_start,czas_stop,rok_symulacji,miesiac_symulacji,dzien_symulacji){
    //definicja zmiennej przechowujacej wspolrzedne i czas
    var property = new Cesium.SampledPositionProperty();
    //definicja czasu jako poczatek lotu
    var time = Cesium.JulianDate.fromDate(new Date(rok_symulacji, miesiac_symulacji, dzien_symulacji, 1));

    //dodanie punktu poczatkowego na pasie w Warszawie
    time = Cesium.JulianDate.addSeconds(time, czas_start, new Cesium.JulianDate());
    var position = Cesium.Cartesian3.fromDegrees(warszawa_pas1.start_long, warszawa_pas1.start_lat, 140.0);
    property.addSample(time, position);
	czasy_WAW_GDN_start[id] = time;

    //dodanie punktu na koncu pasa w Gdansku (60s pozniej)
    time = Cesium.JulianDate.addSeconds(time, 60, new Cesium.JulianDate());
    position = Cesium.Cartesian3.fromDegrees(warszawa_pas1.koniec_long, warszawa_pas1.koniec_lat, 140.0);
    property.addSample(time, position);

    //pozostaly czas na animacje lotu minus 2*60s na start i lądowanie minus 10s wyrównanie lądowania
    var reszta_czasu = czas_stop - czas_start - 120 - 360;
    var krok_czasu = reszta_czasu / 4; //5 kroków (punktow)

    //dodanie punktow dla pozostałego czasu pomiedzy startem i lądowaniem
    for (var i = 1; i <= 4; i += 1) {
      time = Cesium.JulianDate.addSeconds(time, krok_czasu, new Cesium.JulianDate());
      position = Cesium.Cartesian3.fromDegrees(warszawa_pas1.koniec_long - (0.49 * i), warszawa_pas1.koniec_lat + (0.44 * i), ((5 % i)+1) * 11000.0);
      property.addSample(time, position);
    }

    //dodanie punktu na końcu pasa w Gdansku (10s pozniej - trafienie w pas)
    time = Cesium.JulianDate.addSeconds(time, 360, new Cesium.JulianDate());
    position = Cesium.Cartesian3.fromDegrees(gdansk_pas1.koniec_long, gdansk_pas1.koniec_lat, 180.0);
    property.addSample(time, position);

    //dodanie punktu na poczatku pasa w Gdansku (60s pozniej)
    time = Cesium.JulianDate.addSeconds(time, 60, new Cesium.JulianDate());
    position = Cesium.Cartesian3.fromDegrees(gdansk_pas1.start_long, gdansk_pas1.start_lat, 170.0);
    property.addSample(time, position);
	czasy_WAW_GDN_koniec[id] = time;

  return property
  }

  //definicja funkcji zwracającej sciezke lotu samolotu z Warszawy2 do Gdanska
  //przekazywane parametry to wlasciwosci obiektow klasy WawToGdn (wylot,przylot)
  function generuj_trase_WAW2_GDN(id,czas_start,czas_stop,rok_symulacji,miesiac_symulacji,dzien_symulacji){
    //definicja zmiennej przechowujacej wspolrzedne i czas
    var property = new Cesium.SampledPositionProperty();
    //definicja czasu jako poczatek lotu
    var time = Cesium.JulianDate.fromDate(new Date(rok_symulacji, miesiac_symulacji, dzien_symulacji, 1));

    //dodanie punktu poczatkowego na pasie w Warszawie
    time = Cesium.JulianDate.addSeconds(time, czas_start, new Cesium.JulianDate());
    var position = Cesium.Cartesian3.fromDegrees(warszawa_pas2.start_long, warszawa_pas2.start_lat, 140.0);
    property.addSample(time, position);
	czasy_WAW_GDN_start[id] = time;

    //dodanie punktu na koncu pasa w Gdansku (60s pozniej)
    time = Cesium.JulianDate.addSeconds(time, 60, new Cesium.JulianDate());
    position = Cesium.Cartesian3.fromDegrees(warszawa_pas2.koniec_long, warszawa_pas2.koniec_lat, 140.0);
    property.addSample(time, position);

    //pozostaly czas na animacje lotu minus 2*60s na start i lądowanie minus 10s wyrównanie lądowania
    var reszta_czasu = czas_stop - czas_start - 120 - 360;
    var krok_czasu = reszta_czasu / 4; //5 kroków (punktow)

    //dodanie punktow dla pozostałego czasu pomiedzy startem i lądowaniem
    for (var i = 1; i <= 4; i += 1) {
      time = Cesium.JulianDate.addSeconds(time, krok_czasu, new Cesium.JulianDate());
      position = Cesium.Cartesian3.fromDegrees(warszawa_pas2.koniec_long - (0.49 * i), warszawa_pas2.koniec_lat + (0.44 * i), ((5 % i)+1) * 11000.0);
      property.addSample(time, position);
    }

    //dodanie punktu na końcu pasa w Gdansku (10s pozniej - trafienie w pas)
    time = Cesium.JulianDate.addSeconds(time, 360, new Cesium.JulianDate());
    position = Cesium.Cartesian3.fromDegrees(gdansk_pas1.koniec_long, gdansk_pas1.koniec_lat, 180.0);
    property.addSample(time, position);

    //dodanie punktu na poczatku pasa w Gdansku (60s pozniej)
    time = Cesium.JulianDate.addSeconds(time, 60, new Cesium.JulianDate());
    position = Cesium.Cartesian3.fromDegrees(gdansk_pas1.start_long, gdansk_pas1.start_lat, 170.0);
    property.addSample(time, position);
	czasy_WAW_GDN_koniec[id] = time;

  return property
  }


	function stworz_entity(lot,id,nr_lotu) {
		entities.add({
		id: nr_lotu,
		parent: id,
		//Set the entity availability to the same interval as the simulation time.
		availability : new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({
			start : start,
			stop : stop
		})]),

		//Use our computed positions
		position : lot,

		//Automatically compute orientation based on position movement.
		orientation : new Cesium.VelocityOrientationProperty(lot),

		//Load the Cesium plane model to represent the entity
		model : {
			uri : 'SampleData/models/CesiumAir/Cesium_Air.glb',
			minimumPixelSize : 64
		},
		//Show the path as a pink line sampled in 1 second increments.
		path : {
			resolution : 1,
			material : new Cesium.PolylineGlowMaterialProperty({
				glowPower : 0.1,
				color : Cesium.Color.YELLOW
			}),
			width : 10
		}
		});
	}

	//var domyslny_czas = Cesium.JulianDate.fromDate(new Date(2019, 10, 11, 1));
	var rok_symulacji;
	var miesiac_symulacji;
	var dzien_symulacji;

	var domyslny_rok = 2019;
	var domyslny_miesiac = 10;
	var domyslny_dzien = 7;

	rok_symulacji = domyslny_rok;
	miesiac_symulacji = domyslny_miesiac;
	dzien_symulacji = domyslny_dzien

	var viewer = new Cesium.Viewer('cesiumContainer', {
    infoBox: false, //Disable InfoBox widget
    selectionIndicator: false, //Disable selection indicator
    shouldAnimate: true, // Enable animations
    terrainProvider: Cesium.createWorldTerrain()
	});
	var entities = viewer.entities;

	//Enable lighting based on sun/moon positions
	viewer.scene.globe.enableLighting = true;

	//Enable depth testing so things behind the terrain disappear.
	viewer.scene.globe.depthTestAgainstTerrain = true;

	//Set bounds of our simulation time
	var start = Cesium.JulianDate.fromDate(new Date(rok_symulacji, miesiac_symulacji, dzien_symulacji, 7));
	var stop = Cesium.JulianDate.addSeconds(start, 86400, new Cesium.JulianDate());

	//Make sure viewer is at the desired time.
	viewer.clock.startTime = start.clone();
	viewer.clock.stopTime = stop.clone();
	viewer.clock.currentTime = start.clone();
	viewer.clock.clockRange = Cesium.ClockRange.LOOP_STOP; //Loop at the end
	viewer.clock.multiplier = 10;

	//Set timeline to simulation bounds
	viewer.timeline.zoomTo(start, stop);

	//tablice z trasami lotów
	var pozycje_loty_GDN_WAW = [];
	var pozycje_loty_WAW_GDN = [];
 	var pozycje_loty_GDN_WAW2 = [];
	var pozycje_loty_WAW2_GDN = [];

	var czasy_GDN_WAW_start = [];
	var czasy_GDN_WAW_koniec = [];
	var czasy_WAW_GDN_start = [];
	var czasy_WAW_GDN_koniec = [];

	//oblicz trase z nowej funkcji z gdanska do warszawy
	function loty_GDN_WAW(rok_symulacji,miesiac_symulacji,dzien_symulacji) {
		 var position_GDN_WAW = generuj_trase_GDN_WAW(gdnwaw1.id,gdnwaw1.wylot,gdnwaw1.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position2_GDN_WAW = generuj_trase_GDN_WAW(gdnwaw2.id,gdnwaw2.wylot,gdnwaw2.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position3_GDN_WAW = generuj_trase_GDN_WAW(gdnwaw3.id,gdnwaw3.wylot,gdnwaw3.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position4_GDN_WAW = generuj_trase_GDN_WAW(gdnwaw4.id,gdnwaw4.wylot,gdnwaw4.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position5_GDN_WAW = generuj_trase_GDN_WAW(gdnwaw5.id,gdnwaw5.wylot,gdnwaw5.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position6_GDN_WAW = generuj_trase_GDN_WAW(gdnwaw6.id,gdnwaw6.wylot,gdnwaw6.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		pozycje_loty_GDN_WAW[0] = position_GDN_WAW;
		pozycje_loty_GDN_WAW[1] = position2_GDN_WAW;
		pozycje_loty_GDN_WAW[2] = position3_GDN_WAW;
		pozycje_loty_GDN_WAW[3] = position4_GDN_WAW;
		pozycje_loty_GDN_WAW[4] = position5_GDN_WAW;
		pozycje_loty_GDN_WAW[5] = position6_GDN_WAW;
	}

  //oblicz trase z nowej funkcji z gdanska do warszawy2
	function loty_GDN_WAW2(rok_symulacji,miesiac_symulacji,dzien_symulacji) {
		 var position_GDN_WAW2 = generuj_trase_GDN_WAW2(gdnwaw1.id,gdnwaw1.wylot,gdnwaw1.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position2_GDN_WAW2 = generuj_trase_GDN_WAW2(gdnwaw2.id,gdnwaw2.wylot,gdnwaw2.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position3_GDN_WAW2 = generuj_trase_GDN_WAW2(gdnwaw3.id,gdnwaw3.wylot,gdnwaw3.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position4_GDN_WAW2 = generuj_trase_GDN_WAW2(gdnwaw4.id,gdnwaw4.wylot,gdnwaw4.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position5_GDN_WAW2 = generuj_trase_GDN_WAW2(gdnwaw5.id,gdnwaw5.wylot,gdnwaw5.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position6_GDN_WAW2 = generuj_trase_GDN_WAW2(gdnwaw6.id,gdnwaw6.wylot,gdnwaw6.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		pozycje_loty_GDN_WAW2[0] = position_GDN_WAW2;
		pozycje_loty_GDN_WAW2[1] = position2_GDN_WAW2;
		pozycje_loty_GDN_WAW2[2] = position3_GDN_WAW2;
		pozycje_loty_GDN_WAW2[3] = position4_GDN_WAW2;
		pozycje_loty_GDN_WAW2[4] = position5_GDN_WAW2;
		pozycje_loty_GDN_WAW2[5] = position6_GDN_WAW2;
	}

	//oblicz trase z nowej funkcji z Warszawy do Gdańska
	function loty_WAW_GDN(rok_symulacji,miesiac_symulacji,dzien_symulacji) {
		 var position_WAW_GDN = generuj_trase_WAW_GDN(wawgdn1.id,wawgdn1.wylot,wawgdn1.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position2_WAW_GDN = generuj_trase_WAW_GDN(wawgdn2.id,wawgdn2.wylot,wawgdn2.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position3_WAW_GDN = generuj_trase_WAW_GDN(wawgdn3.id,wawgdn3.wylot,wawgdn3.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position4_WAW_GDN = generuj_trase_WAW_GDN(wawgdn4.id,wawgdn4.wylot,wawgdn4.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position5_WAW_GDN = generuj_trase_WAW_GDN(wawgdn5.id,wawgdn5.wylot,wawgdn5.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position6_WAW_GDN = generuj_trase_WAW_GDN(wawgdn6.id,wawgdn6.wylot,wawgdn6.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		pozycje_loty_WAW_GDN[0] = position_WAW_GDN;
		pozycje_loty_WAW_GDN[1] = position2_WAW_GDN;
		pozycje_loty_WAW_GDN[2] = position3_WAW_GDN;
		pozycje_loty_WAW_GDN[3] = position4_WAW_GDN;
		pozycje_loty_WAW_GDN[4] = position5_WAW_GDN;
		pozycje_loty_WAW_GDN[5] = position6_WAW_GDN;
	}

  //oblicz trase z nowej funkcji z Warszawy do Gdańska
	function loty_WAW2_GDN(rok_symulacji,miesiac_symulacji,dzien_symulacji) {
		 var position_WAW2_GDN = generuj_trase_WAW2_GDN(wawgdn1.id,wawgdn1.wylot,wawgdn1.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position2_WAW2_GDN = generuj_trase_WAW2_GDN(wawgdn2.id,wawgdn2.wylot,wawgdn2.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position3_WAW2_GDN = generuj_trase_WAW2_GDN(wawgdn3.id,wawgdn3.wylot,wawgdn3.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position4_WAW2_GDN = generuj_trase_WAW2_GDN(wawgdn4.id,wawgdn4.wylot,wawgdn4.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position5_WAW2_GDN = generuj_trase_WAW2_GDN(wawgdn5.id,wawgdn5.wylot,wawgdn5.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		var position6_WAW2_GDN = generuj_trase_WAW2_GDN(wawgdn6.id,wawgdn6.wylot,wawgdn6.przylot,rok_symulacji,miesiac_symulacji,dzien_symulacji);
		pozycje_loty_WAW2_GDN[0] = position_WAW2_GDN;
		pozycje_loty_WAW2_GDN[1] = position2_WAW2_GDN;
		pozycje_loty_WAW2_GDN[2] = position3_WAW2_GDN;
		pozycje_loty_WAW2_GDN[3] = position4_WAW2_GDN;
		pozycje_loty_WAW2_GDN[4] = position5_WAW2_GDN;
		pozycje_loty_WAW2_GDN[5] = position6_WAW2_GDN;
	}


	//dodanie do entity trasy dla każdego z lotów z tablicy pozycje_loty_GDN_WAW
	


	
	var id_tab_GDN_WAW = [];
	var id_tab_WAW_GDN = [];
  	//var id_tab_GDN_WAW2 = [];
	//var id_tab_WAW2_GDN = [];

	function inicjalizacja_entity(rok_symulacji,miesiac_symulacji,dzien_symulacji) {
		id_tab_GDN_WAW = [];
		id_tab_WAW_GDN = [];
		loty_GDN_WAW(rok_symulacji,miesiac_symulacji,dzien_symulacji);
		loty_WAW_GDN(rok_symulacji,miesiac_symulacji,dzien_symulacji);

		for (var i=0; i<6; i++) {
			var id = gdnwaw[i].numer_lotu;
			id = entities.add(new Cesium.Entity());
			id_tab_GDN_WAW[i] = id;
			stworz_entity(pozycje_loty_GDN_WAW[i], id, gdnwaw[i].numer_lotu);
		}


		for (var i=0; i<6; i++) {
			var id = wawgdn[i].numer_lotu;
			id = entities.add(new Cesium.Entity());
			id_tab_WAW_GDN[i] = id;
			stworz_entity(pozycje_loty_WAW_GDN[i], id, wawgdn[i].numer_lotu);
		}
	}

  function inicjalizacja_entity_2(rok_symulacji,miesiac_symulacji,dzien_symulacji) {
	id_tab_GDN_WAW = [];
	id_tab_WAW_GDN = [];
    loty_GDN_WAW2(rok_symulacji,miesiac_symulacji,dzien_symulacji);
    loty_WAW2_GDN(rok_symulacji,miesiac_symulacji,dzien_symulacji);

    for (var i=0; i<6; i++) {
      var id = gdnwaw[i].numer_lotu;
      id = entities.add(new Cesium.Entity());
      id_tab_GDN_WAW[i] = id;
      stworz_entity(pozycje_loty_GDN_WAW2[i], id, gdnwaw[i].numer_lotu);
    }


    for (var i=0; i<6; i++) {
      var id = wawgdn[i].numer_lotu;
      id = entities.add(new Cesium.Entity());
      id_tab_WAW_GDN[i] = id;
      stworz_entity(pozycje_loty_WAW2_GDN[i], id, wawgdn[i].numer_lotu);
    }
  }

  var rob;
  function pas1()
  {
	rob = false;
    for (var i=0; i<6; i++) {
			viewer.entities.removeById(gdnwaw[i].numer_lotu);
			viewer.entities.removeById(wawgdn[i].numer_lotu);
		}
    inicjalizacja_entity(rok_symulacji,miesiac_symulacji,dzien_symulacji);
	rob = true;
	rob_tablice(rob);
  }

  function pas2()
  {
	rob = false;
    for (var i=0; i<6; i++) {
			viewer.entities.removeById(gdnwaw[i].numer_lotu);
			viewer.entities.removeById(wawgdn[i].numer_lotu);
		}
    inicjalizacja_entity_2(rok_symulacji,miesiac_symulacji,dzien_symulacji);
	rob = true;
	rob_tablice(rob);
  }

	//tworzenie tablicy
	var table_GDN_WAW = document.getElementById("lista_lotow_GDN-WAW");
	var table_WAW_GDN = document.getElementById("lista_lotow_WAW-GDN");
	async function rob_tablice(rob){
		index_GDN_WAW = 1;
		index_WAW_GDN = 1;
		while(rob){
			for (var i=0; i<6; i++) {
				var teraz = viewer.clock.currentTime;
				if((teraz.secondsOfDay >= czasy_GDN_WAW_start[i].secondsOfDay) && (teraz.secondsOfDay <= czasy_GDN_WAW_koniec[i].secondsOfDay)) {
					if(!(table_GDN_WAW.rows.namedItem(gdnwaw[i].numer_lotu))){
						//console.log("i złapane", i);
						//console.log("nr zlapane", gdnwaw[i].numer_lotu);
						//console.log("teraz", teraz);
						//console.log("start", czasy_GDN_WAW_start[i].secondsOfDay);
						//console.log("koniec", czasy_GDN_WAW_koniec[i].secondsOfDay);
						var row = table_GDN_WAW.insertRow(index_GDN_WAW);
						row.id = gdnwaw[i].numer_lotu;
						var cell_wylot = row.insertCell(0);
						var cell_przylot = row.insertCell(1);
						var cell_numer = row.insertCell(2);
						cell_wylot.innerHTML = gdnwaw[i].wylot2;
						cell_przylot.innerHTML = gdnwaw[i].przylot2;
						cell_numer.innerHTML = gdnwaw[i].numer_lotu;
						index_GDN_WAW+=1;
					}
				}
				if((teraz.secondsOfDay <= czasy_GDN_WAW_start[i].secondsOfDay) || (teraz.secondsOfDay >= czasy_GDN_WAW_koniec[i].secondsOfDay)) {
					//console.log("i niezłapane", i);
					//console.log("nr niezlapane", gdnwaw[i].numer_lotu);
					try {
						var rowIndex = document.getElementById(gdnwaw[i].numer_lotu).rowIndex;
						table_GDN_WAW.deleteRow(rowIndex);
						//console.log("dziala", row.id);
						index_GDN_WAW-=1;
					}
					catch(err) {
						//console.log("error: ",err.message);
					}
				}
				//await sleep(2000);
			}
			for (var i=0; i<6; i++) {
				var teraz = viewer.clock.currentTime;
				if((teraz.secondsOfDay >= czasy_WAW_GDN_start[i].secondsOfDay) && (teraz.secondsOfDay <= czasy_WAW_GDN_koniec[i].secondsOfDay)) {
					if(!(table_WAW_GDN.rows.namedItem(wawgdn[i].numer_lotu))){
						//console.log("i złapane", i);
						//console.log("nr zlapane", wawgdn[i].numer_lotu);
						//console.log("teraz", teraz);
						//console.log("start", czasy_WAW_GDN_start[i].secondsOfDay);
						//console.log("koniec", czasy_WAW_GDN_koniec[i].secondsOfDay);
						var row = table_WAW_GDN.insertRow(index_WAW_GDN);
						row.id = wawgdn[i].numer_lotu;
						var cell_wylot = row.insertCell(0);
						var cell_przylot = row.insertCell(1);
						var cell_numer = row.insertCell(2);
						cell_wylot.innerHTML = wawgdn[i].wylot2;
						cell_przylot.innerHTML = wawgdn[i].przylot2;
						cell_numer.innerHTML = wawgdn[i].numer_lotu;
						index_WAW_GDN+=1;
					}
				}
				if((teraz.secondsOfDay <= czasy_WAW_GDN_start[i].secondsOfDay) || (teraz.secondsOfDay >= czasy_WAW_GDN_koniec[i].secondsOfDay)) {
					//console.log("i niezłapane", i);
					//console.log("nr niezlapane", wawgdn[i].numer_lotu);
					try {
						var rowIndex = document.getElementById(wawgdn[i].numer_lotu).rowIndex;
						table_WAW_GDN.deleteRow(rowIndex);
						//console.log("dziala", row.id);
						index_WAW_GDN-=1;
					}
					catch(err) {
						console.log("error: ",err.message);
					}
				}
				//await sleep(2000);
			}
			await sleep(2000);
		}
	}
	//rob_tablice();

  </script>
</body>
</html>
