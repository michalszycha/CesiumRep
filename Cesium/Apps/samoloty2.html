<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Use correct character set. -->
  <meta charset="utf-8">
  <!-- Tell IE to use the latest, best version. -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <title>Samoloty</title>
  <script src="../Build/Cesium/Cesium.js"></script>
  <style>
      @import url(../Build/Cesium/Widgets/widgets.css);
      html, body, #cesiumContainer {
          width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
      }
  </style>
</head>
<body>
  <div id="cesiumContainer">



<div id="buttonContainer" style="position:absolute; left:2px; top:25px;
z-index:1;">
<button onclick="patrz_z_gory()" class="cesiumbutton">
Patrz z góry</button>
</div>

<div id="buttonContainer" style="position:absolute; left:2px; top:48px;
z-index:1;">
<button onclick="zmien_czas(2019,5,5,5+2)" class="cesiumbutton">
5. czerwiec 2019</button>
</div>

<div id="buttonContainer" style="position:absolute; left:2px; top:71px;
z-index:1;">
<button onclick="zmien_czas(2018,8,29,9+2)" class="cesiumbutton">
29. wrzesień 2018</button>
</div>

<div id="buttonContainer" style="position:absolute; left:2px; top:94px;
z-index:1;">
<button onclick="zmien_czas(2017,1,18,12+2)" class="cesiumbutton">
18. luty 2017</button>
</div>

<div id="buttonContainer" style="position:absolute; left:2px; top:150px;
z-index:1;">
<button onclick="ukryj_lot_GDN_WAW1()" class="cesiumbutton">
Ukryj/pokaz lot LO3832</button>
</div>
<div id="buttonContainer" style="position:absolute; left:2px; top:173px;
z-index:1;">
<button onclick="ukryj_lot_GDN_WAW2()" class="cesiumbutton">
Ukryj/pokaz lot LO3836</button>
</div>
<div id="buttonContainer" style="position:absolute; left:2px; top:196px;
z-index:1;">
<button onclick="ukryj_lot_GDN_WAW3()" class="cesiumbutton">
Ukryj/pokaz lot LO3816</button>
</div>

<div id="buttonContainer" style="position:absolute;left:2px;top:250px;
z-index:1;">
<button onclick="obserwuj_lot_GDN_WAW1()" class="cesiumbutton">
Obserwuj samolot LO3832</button>
</div>
<div id="buttonContainer" style="position:absolute;left:2px;top:273px;
z-index:1;">
<button onclick="obserwuj_lot_GDN_WAW2()" class="cesiumbutton">
Obserwuj samolot LO3836</button>
</div>
<div id="buttonContainer" style="position:absolute;left:2px;top:296px;
z-index:1;">
<button onclick="obserwuj_lot_GDN_WAW3()" class="cesiumbutton">
Obserwuj samolot LO3816</button>
</div>

</div>

  <script>

	//var domyslny_czas = Cesium.JulianDate.fromDate(new Date(2019, 10, 11, 1));
	//console.info("domyslny", domyslny_czas);

	class Czas {
		constructor(rok,miesiac,dzien,godzina) {
			this.rok = rok;
			this.miesiac = miesiac;
			this.dzien = dzien;
			this.godzina = godzina;
		}

		zwroc_czas() {
			var czas_cesium = Cesium.JulianDate.fromDate(new Date(this.rok, this.miesiac, this.dzien, this.godzina));
			return czas_cesium;
		}
	}

	//Definicja klasy wspolrzednych pasow startowych
	class PasyStartowe {
		constructor(start_lat, start_long, koniec_lat, koniec_long){
		this.start_lat = start_lat;
		this.start_long = start_long;
		this.koniec_lat = koniec_lat;
		this.koniec_long = koniec_long;
		}
	}
	//Stworzenie obiektów konkretnych pasów startowych
	gdansk_pas1 = new PasyStartowe(54.380887, 18.452738, 54.371910, 18.489267);
	warszawa_pas1 = new PasyStartowe(52.155907, 20.975687, 52.177143, 20.957177);


	//Definicja klasy lotow z Gdanska do Warszawy
	class GdnToWaw {
		constructor(wylot, przylot, numer_lotu) {
		this.wylot = wylot;
		this.przylot = przylot;
		this.numer_lotu = numer_lotu;
		}

	}

	//Stworzenie obiektow konkretnych lotow klasy Gdansk - Warszawa
	gdnwaw1 = new GdnToWaw(31500,35100,'LO3832'); //8:45 - 09:45
	gdnwaw2 = new GdnToWaw(43500,47100,'LO3836'); //12:05 - 13:05
	gdnwaw3 = new GdnToWaw(65400,69300,'LO3816'); //18:10 - 19:15

	//tabilca z lotami Gdansk - Warszawa
	var gdnwaw = [];
	gdnwaw[0] = gdnwaw1;
	gdnwaw[1] = gdnwaw2;
	gdnwaw[2] = gdnwaw3;


	//Definicja klasy lotow z Warszawy do Gdanska
	class WawToGdn {
		constructor(wylot, przylot, numer_lotu) {
		this.wylot = wylot;
		this.przylot = przylot;
		this.numer_lotu = numer_lotu;
		}
	}

	//Stworzenie obiektow konkretnych lotow klasy Warszawa - Gdansk
	wawgdn1 = new WawToGdn(26100,29700,'LO3831'); //7:15 - 08:15
	wawgdn2 = new WawToGdn(48000,51300,'LO3937'); //13:20 - 14:15
	wawgdn3 = new WawToGdn(70800,74100,'LO3825'); //19:40 - 20:35

	var track_gdnwaw1 = true;
	var track_gdnwaw2 = true;
	var track_gdnwaw3 = true;
	//funkcje do śledzenia konkretnych lotów
	function obserwuj_lot_GDN_WAW1() {
		if(track_gdnwaw1) {
			viewer.trackedEntity = viewer.entities.getById('LO3832');
		}
		else {
			viewer.trackedEntity = undefined;
		}
		track_gdnwaw1 = !track_gdnwaw1;
	}
	function obserwuj_lot_GDN_WAW2() {
		if(track_gdnwaw2) {
			viewer.trackedEntity = viewer.entities.getById('LO3836');
		}
		else {
			viewer.trackedEntity = undefined;
		}
		track_gdnwaw2 = !track_gdnwaw2;
	}
	function obserwuj_lot_GDN_WAW3() {
		if(track_gdnwaw3) {
			viewer.trackedEntity = viewer.entities.getById('LO3816');
		}
		else {
			viewer.trackedEntity = undefined;
		}
		track_gdnwaw3 = !track_gdnwaw3;
	}

	function patrz_z_gory() {
		viewer.trackedEntity = undefined;
		viewer.zoomTo(viewer.entities, new Cesium.HeadingPitchRange(0, Cesium.Math.toRadians(-90)));
	}


	//definicja funkcji zwracającej sciezke lotu samolotu z Gdanska do Warszawy
	//przekazywane parametry to wlasciwosci obiektow klasy GdnToWaw (wylot,przylot)
	function generuj_trase_GDN_WAW(czas_start,czas_stop){
		//definicja zmiennej przechowujacej wspolrzedne i czas
		var property = new Cesium.SampledPositionProperty();
		//definicja czasu jako poczatek lotu
		var time = Cesium.JulianDate.fromDate(new Date(2019, 10, 11, 1));

		//dodanie punktu poczatkowego na pasie w Gdansku
		time = Cesium.JulianDate.addSeconds(time, czas_start, new Cesium.JulianDate());
		var position = Cesium.Cartesian3.fromDegrees(gdansk_pas1.start_long, gdansk_pas1.start_lat, 170.0);
		property.addSample(time, position);

		//dodanie punktu na koncu pasa w Gdansku (60s pozniej)
		time = Cesium.JulianDate.addSeconds(time, 60, new Cesium.JulianDate());
		position = Cesium.Cartesian3.fromDegrees(gdansk_pas1.koniec_long, gdansk_pas1.koniec_lat, 180.0);
		property.addSample(time, position);

		//pozostaly czas na animacje lotu minus 2*60s na start i lądowanie minus 10s wyrównanie lądowania
		var reszta_czasu = czas_stop - czas_start - 120 - 10;
		var krok_czasu = reszta_czasu / 4; //4 kroków (punktow)

		//dodanie punktow dla pozostałego czasu pomiedzy startem i lądowaniem
		for (var i = 1; i <= 4; i += 1) {
			time = Cesium.JulianDate.addSeconds(time, krok_czasu, new Cesium.JulianDate());
			position = Cesium.Cartesian3.fromDegrees(gdansk_pas1.koniec_long + (0.49 * i), gdansk_pas1.koniec_lat - (0.44 * i), ((5 % i)+1) * 11000.0);
			property.addSample(time, position);
		}

		//dodanie punktu na końcu pasa w Warszawie (10s pozniej - trafienie w pas)
		time = Cesium.JulianDate.addSeconds(time, 10, new Cesium.JulianDate());
		position = Cesium.Cartesian3.fromDegrees(warszawa_pas1.koniec_long, warszawa_pas1.koniec_lat, 140.0);
		property.addSample(time, position);

		//dodanie punktu na poczatku pasa w Warszawie (60s pozniej)
		time = Cesium.JulianDate.addSeconds(time, 60, new Cesium.JulianDate());
		position = Cesium.Cartesian3.fromDegrees(warszawa_pas1.start_long, warszawa_pas1.start_lat, 140.0);
		property.addSample(time, position);

	return property
	}


  //definicja funkcji zwracającej sciezke lotu samolotu z Warszawy do Gdanska
  //przekazywane parametry to wlasciwosci obiektow klasy WawToGdn (wylot,przylot)
  function generuj_trase_WAW_GDN(czas_start,czas_stop){
    //definicja zmiennej przechowujacej wspolrzedne i czas
    var property = new Cesium.SampledPositionProperty();
    //definicja czasu jako poczatek lotu
    var time = Cesium.JulianDate.fromDate(new Date(2019, 10, 11, 1));

    //dodanie punktu poczatkowego na pasie w Warszawie
    time = Cesium.JulianDate.addSeconds(time, czas_start, new Cesium.JulianDate());
    var position = Cesium.Cartesian3.fromDegrees(warszawa_pas1.start_long, warszawa_pas1.start_lat, 140.0);
    property.addSample(time, position);

    //dodanie punktu na koncu pasa w Gdansku (60s pozniej)
    time = Cesium.JulianDate.addSeconds(time, 60, new Cesium.JulianDate());
    position = Cesium.Cartesian3.fromDegrees(warszawa_pas1.koniec_long, warszawa_pas1.koniec_lat, 140.0);
    property.addSample(time, position);

    //pozostaly czas na animacje lotu minus 2*60s na start i lądowanie minus 10s wyrównanie lądowania
    var reszta_czasu = czas_stop - czas_start - 120 - 10;
    var krok_czasu = reszta_czasu / 4; //5 kroków (punktow)

    //dodanie punktow dla pozostałego czasu pomiedzy startem i lądowaniem
    for (var i = 1; i <= 4; i += 1) {
      time = Cesium.JulianDate.addSeconds(time, krok_czasu, new Cesium.JulianDate());
      position = Cesium.Cartesian3.fromDegrees(warszawa_pas1.koniec_long - (0.49 * i), warszawa_pas1.koniec_lat + (0.44 * i), ((5 % i)+1) * 11000.0);
      property.addSample(time, position);
    }

    //dodanie punktu na końcu pasa w Gdansku (10s pozniej - trafienie w pas)
    time = Cesium.JulianDate.addSeconds(time, 10, new Cesium.JulianDate());
    position = Cesium.Cartesian3.fromDegrees(gdansk_pas1.koniec_long, gdansk_pas1.koniec_lat, 1480.0);
    property.addSample(time, position);

    //dodanie punktu na poczatku pasa w Gdansku (60s pozniej)
    time = Cesium.JulianDate.addSeconds(time, 60, new Cesium.JulianDate());
    position = Cesium.Cartesian3.fromDegrees(gdansk_pas1.start_long, gdansk_pas1.start_lat, 170.0);
    property.addSample(time, position);

  return property
  }


	function stworz_entity(lot,id,nr_lotu) {
		entities.add({
		id: nr_lotu,
		parent: id,
		//Set the entity availability to the same interval as the simulation time.
		availability : new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({
			start : start,
			stop : stop
		})]),

		//Use our computed positions
		position : lot,

		//Automatically compute orientation based on position movement.
		orientation : new Cesium.VelocityOrientationProperty(lot),

		//Load the Cesium plane model to represent the entity
		model : {
			uri : 'SampleData/models/CesiumAir/Cesium_Air.glb',
			minimumPixelSize : 64
		},
		//Show the path as a pink line sampled in 1 second increments.
		path : {
			resolution : 1,
			material : new Cesium.PolylineGlowMaterialProperty({
				glowPower : 0.1,
				color : Cesium.Color.YELLOW
			}),
			width : 10
		}
		});
	}

	//funkcja zmiany czasy symulacji
	function zmien_czas(rok_start, miesiac_start, dzien_start, godzina_start) {
		czas_start = new Czas(rok_start,miesiac_start,dzien_start,godzina_start)
		var start = czas_start.zwroc_czas();
		var stop = Cesium.JulianDate.addSeconds(start, 86400, new Cesium.JulianDate());
		viewer.clock.startTime = start.clone();
		viewer.clock.stopTime = stop.clone();
		viewer.clock.currentTime = start.clone();
		viewer.clock.clockRange = Cesium.ClockRange.LOOP_STOP; //Loop at the end
		viewer.clock.multiplier = 10;
	}

	//funkcje do pokazywania/ukrywania poszczególnych lotów
	function ukryj_lot_GDN_WAW1() {
		id_tab[0].show = !id_tab[0].show;
	}
	function ukryj_lot_GDN_WAW2() {
		id_tab[1].show = !id_tab[1].show;
	}
	function ukryj_lot_GDN_WAW3() {
		id_tab[2].show = !id_tab[2].show;
	}

	var viewer = new Cesium.Viewer('cesiumContainer', {
    infoBox: false, //Disable InfoBox widget
    selectionIndicator: false, //Disable selection indicator
    shouldAnimate: true, // Enable animations
    terrainProvider: Cesium.createWorldTerrain()
	});
	var entities = viewer.entities;

	//Enable lighting based on sun/moon positions
	viewer.scene.globe.enableLighting = true;

	//Enable depth testing so things behind the terrain disappear.
	viewer.scene.globe.depthTestAgainstTerrain = true;

	//Set bounds of our simulation time
	var start = Cesium.JulianDate.fromDate(new Date(2019, 10, 11, 7));
	var stop = Cesium.JulianDate.addSeconds(start, 86400, new Cesium.JulianDate());

	//Make sure viewer is at the desired time.
	viewer.clock.startTime = start.clone();
	viewer.clock.stopTime = stop.clone();
	viewer.clock.currentTime = start.clone();
	viewer.clock.clockRange = Cesium.ClockRange.LOOP_STOP; //Loop at the end
	viewer.clock.multiplier = 10;

	//Set timeline to simulation bounds
	viewer.timeline.zoomTo(start, stop);

	//tablice z trasami lotów
	var pozycje_loty_GDN_WAW = [];
	var pozycje_loty_WAW_GDN = [];
	//oblicz trase z nowej funkcji z gdanska do warszawy
	var position_GDN_WAW = generuj_trase_GDN_WAW(gdnwaw1.wylot,gdnwaw1.przylot);
	var position2_GDN_WAW = generuj_trase_GDN_WAW(gdnwaw2.wylot,gdnwaw2.przylot);
	var position3_GDN_WAW = generuj_trase_GDN_WAW(gdnwaw3.wylot,gdnwaw3.przylot);
	pozycje_loty_GDN_WAW[0] = position_GDN_WAW;
	pozycje_loty_GDN_WAW[1] = position2_GDN_WAW;
	pozycje_loty_GDN_WAW[2] = position3_GDN_WAW;

	//oblicz trase z nowej funkcji z Warszawy do Gdańska
	/*
	var position_WAW_GDN = generuj_trase_WAW_GDN(wawgdn1.wylot,wawgdn1.przylot);
	var position2_WAW_GDN = generuj_trase_WAW_GDN(wawgdn2.wylot,wawgdn2.przylot);
	var position3_WAW_GDN = generuj_trase_WAW_GDN(wawgdn3.wylot,wawgdn3.przylot);
	loty_WAW_GDN[0] = position_WAW_GDN;
	loty_WAW_GDN[1] = position2_WAW_GDN;
	loty_WAW_GDN[2] = position3_WAW_GDN;
	*/

	//dodanie do entity trasy dla każdego z lotów z tablicy pozycje_loty_GDN_WAW
	var id_tab = [];
	for (var i=0; i<3; i++) {
		var id = gdnwaw[i].numer_lotu;
		id = entities.add(new Cesium.Entity());
		id_tab[i] = id;
		stworz_entity(pozycje_loty_GDN_WAW[i], id, gdnwaw[i].numer_lotu);
	}

  </script>
</body>
</html>
